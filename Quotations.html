<script>
    let quotes = [];

    function seededRandom(seed) {
        let x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
    }

    function getQuoteSeed() {
        const today = new Date().toDateString();
        return today.split('').reduce((a, c) => a + c.charCodeAt(0), 0);
    }

    async function loadQuotes() {
        try {
            const response = await fetch('https://raw.githubusercontent.com/Slapped1/QuoteOfTheDay/main/quotes.json?t=' + new Date().getTime());
            if (!response.ok) throw new Error('Failed to fetch quotes');
            const data = await response.json();
            quotes = data.quotes || [];
            displayRandomQuote();
        } catch (error) {
            console.error('Error loading quotes:', error);
            const quoteDiv = document.getElementById('quoteDisplay');
            if (quoteDiv) quoteDiv.innerText = 'Error loading quote';
        }
    }

    function displayRandomQuote() {
        if (!quotes.length) return;
        const seed = getQuoteSeed();
        const randomIndex = Math.floor(seededRandom(seed) * quotes.length);
        const selectedQuote = quotes[randomIndex];
        const quoteDiv = document.getElementById('quoteDisplay');
        if (quoteDiv) quoteDiv.innerText = `"${selectedQuote.text}" - ${selectedQuote.author}`;
    }

    function updateCountdown() {
        const now = new Date();
        const tomorrow = new Date(now);
        tomorrow.setDate(now.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        const timeLeft = tomorrow - now;
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        const countdownDiv = document.getElementById('countdown');
        if (countdownDiv) countdownDiv.innerText = `Countdown until new quote: ${hours}h ${minutes}m ${seconds}s`;
    }

    function generateSparkles() {
        const sparkleContainer = document.getElementById('sparkleContainer');
        if (!sparkleContainer) return;
        for (let i = 0; i < 20; i++) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.top = `${Math.random() * 100}%`;
            sparkle.style.left = `${Math.random() * 100}%`;
            sparkle.style.animationDelay = `${Math.random() * 5}s`;
            sparkleContainer.appendChild(sparkle);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadQuotes();
        generateSparkles();
        updateCountdown();
        setInterval(updateCountdown, 1000);
    });
</script>
